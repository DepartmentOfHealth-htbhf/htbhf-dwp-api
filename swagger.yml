swagger: "2.0"
info:
  description: "Responsible for taking Universal Credit eligibility requests and checking\
    \ them against DWP data in an internal database before making a call to the real\
    \ DWP API."
  title: "DWP API Service"
  contact:
    name: "Department Of Health"
    url: "https://github.com/DepartmentOfHealth-htbhf"
    email: "dh-htbhf-team@equalexperts.com"
  license:
    name: "MIT"
    url: "https://opensource.org/licenses/MIT"
host: "N/A"
basePath: "/"
tags:
- name: "dwp-eligibility-controller"
  description: "Endpoints for dealing with DWP Eligibility requests."
- name: "dwp-eligibility-controller-v-2"
  description: "Endpoints for dealing with DWP Identity and Eligibility requests."
paths:
  /v1/dwp/eligibility:
    post:
      tags:
      - "dwp-eligibility-controller"
      summary: "Retrieve the eligibility of a person for Universal Credit"
      operationId: "getBenefitsUsingPOST"
      consumes:
      - "application/json"
      produces:
      - "*/*"
      parameters:
      - in: "body"
        name: "eligibilityRequest"
        description: "The eligibility request for Universal Credit"
        required: false
        schema:
          $ref: "#/definitions/EligibilityRequest"
      responses:
        "200":
          description: "The person's eligibility for Universal Credit"
          schema:
            $ref: "#/definitions/EligibilityResponse"
        "201":
          description: "Created"
        "401":
          description: "Unauthorized"
        "403":
          description: "Forbidden"
        "404":
          description: "Not Found"
      deprecated: false
  /v2/dwp/eligibility:
    get:
      tags:
      - "dwp-eligibility-controller-v-2"
      summary: "Verify a person's identity and eligibility for benefits with DWP"
      operationId: "getBenefitsUsingGET"
      produces:
      - "*/*"
      parameters:
      - name: "eligibilityEndDate"
        in: "query"
        required: true
        type: "string"
        format: "date"
      - name: "person.addressLine1"
        in: "query"
        required: true
        type: "string"
      - name: "person.dateOfBirth"
        in: "query"
        required: true
        type: "string"
        format: "date"
      - name: "person.emailAddress"
        in: "query"
        required: false
        type: "string"
        pattern: "(^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+$)"
      - name: "person.mobilePhoneNumber"
        in: "query"
        required: false
        type: "string"
        pattern: "^\\+44\\d{9,10}$"
      - name: "person.nino"
        in: "query"
        required: true
        type: "string"
        pattern: "^(?!BG|GB|NK|KN|TN|NT|ZZ)[A-CEGHJ-PR-TW-Z][A-CEGHJ-NPR-TW-Z](\\\
          d{6})[A-D]$"
      - name: "person.postcode"
        in: "query"
        required: true
        type: "string"
        pattern: "^(GIR ?0AA|[A-PR-UWYZ]([0-9]{1,2}|([A-HK-Y][0-9]([0-9ABEHMNPRV-Y])?)|[0-9][A-HJKPS-UW])\
          \ ?[0-9][ABD-HJLNP-UW-Z]{2})$"
      - name: "person.pregnantDependentDob"
        in: "query"
        required: false
        type: "string"
        format: "date"
      - name: "person.surname"
        in: "query"
        required: true
        type: "string"
      - name: "ucMonthlyIncomeThresholdInPence"
        in: "query"
        required: false
        type: "integer"
        format: "int32"
      responses:
        "200":
          description: "The person's identity status and eligibility for DWP Benefits"
          schema:
            $ref: "#/definitions/IdentityAndEligibilityResponse"
        "401":
          description: "Unauthorized"
        "403":
          description: "Forbidden"
        "404":
          description: "Not Found"
      deprecated: false
definitions:
  AddressDTO:
    type: "object"
    properties:
      addressLine1:
        type: "string"
        example: "Flat B"
        description: "First line of the address"
      addressLine2:
        type: "string"
        example: "221 Baker Street"
        description: "Second line of the address"
      postcode:
        type: "string"
        example: "AA1 1AA"
        description: "The postcode of the address."
      townOrCity:
        type: "string"
        example: "London"
        description: "Town or city of the address"
    title: "AddressDTO"
    description: "The address object"
  ChildDTO:
    type: "object"
    properties:
      dateOfBirth:
        type: "string"
        format: "date"
        description: "The date of birth of the child"
    title: "ChildDTO"
    description: "A child in a household."
  EligibilityRequest:
    type: "object"
    properties:
      eligibleEndDate:
        type: "string"
        format: "date"
        example: "2019-02-01"
        description: "The end date for eligibility"
      eligibleStartDate:
        type: "string"
        format: "date"
        example: "2019-01-01"
        description: "The start date for eligibility"
      person:
        description: "Details of the person"
        $ref: "#/definitions/PersonDTO"
      ucMonthlyIncomeThreshold:
        type: "number"
        example: 408.0
        description: "The monthly income threshold for Universal Credit"
    title: "EligibilityRequest"
    description: "The eligibility request for Universal Credit"
  EligibilityResponse:
    type: "object"
    properties:
      children:
        type: "array"
        description: "A list of the children (under four years old) in the household"
        items:
          $ref: "#/definitions/ChildDTO"
      eligibilityStatus:
        type: "string"
        example: "ELIGIBLE"
        description: "The eligibility status"
        enum:
        - "ELIGIBLE"
        - "INELIGIBLE"
        - "PENDING"
        - "NO_MATCH"
        - "ERROR"
        - "DUPLICATE"
      householdIdentifier:
        type: "string"
        example: "9d6049ee-d6e6-4d9b-ae3d-3b1bdf98682f"
        description: "The identifier for their household"
      numberOfChildrenUnderFour:
        type: "integer"
        format: "int32"
        example: 1
        description: "The number of children under 4 that the person has (which will\
          \ include the number of children under 1)"
      numberOfChildrenUnderOne:
        type: "integer"
        format: "int32"
        example: 1
        description: "The number of children under 1 that the person has"
    title: "EligibilityResponse"
    description: "The eligibility response from DWP"
  IdentityAndEligibilityResponse:
    type: "object"
    properties:
      addressLine1Match:
        type: "string"
        enum:
        - "matched"
        - "not_matched"
        - "not_held"
        - "not_supplied"
        - "invalid_format"
        - "not_set"
      deathVerificationFlag:
        type: "string"
        enum:
        - "n/a"
        - "death_not_verified"
        - "limited_supporting_documentation"
        - "partial_supporting_documentation"
        - "full_supporting_documentation"
      dobOfChildrenUnder4:
        type: "array"
        items:
          $ref: "#/definitions/LocalDate"
      eligibilityStatus:
        type: "string"
        enum:
        - "confirmed"
        - "not_confirmed"
        - "not_set"
      emailAddressMatch:
        type: "string"
        enum:
        - "matched"
        - "not_matched"
        - "not_held"
        - "not_supplied"
        - "invalid_format"
        - "not_set"
      householdIdentifier:
        type: "string"
      identityStatus:
        type: "string"
        enum:
        - "matched"
        - "not_matched"
      mobilePhoneMatch:
        type: "string"
        enum:
        - "matched"
        - "not_matched"
        - "not_held"
        - "not_supplied"
        - "invalid_format"
        - "not_set"
      postcodeMatch:
        type: "string"
        enum:
        - "matched"
        - "not_matched"
        - "not_held"
        - "not_supplied"
        - "invalid_format"
        - "not_set"
      pregnantChildDOBMatch:
        type: "string"
        enum:
        - "matched"
        - "not_matched"
        - "not_held"
        - "not_supplied"
        - "invalid_format"
        - "not_set"
      qualifyingBenefits:
        type: "string"
        enum:
        - "universal_credit"
        - "employment_and_support_allowance"
        - "income_support"
        - "jobseekers_allowance"
        - "pension_credit"
        - "not_set"
    title: "IdentityAndEligibilityResponse"
  PersonDTO:
    type: "object"
    properties:
      address:
        description: "The person's address"
        $ref: "#/definitions/AddressDTO"
      dateOfBirth:
        type: "string"
        format: "date"
        example: "1985-12-30"
        description: "The date of birth, in the format YYYY-MM-DD"
      firstName:
        type: "string"
        example: "Lisa"
        description: "The person's first name"
      lastName:
        type: "string"
        example: "Simpson"
        description: "The person's last name"
      nino:
        type: "string"
        example: "QQ123456C"
        description: "National Insurance number"
        pattern: "[a-zA-Z]{2}\\d{6}[a-dA-D]"
    title: "PersonDTO"
    description: "The person who we are checking eligibility for"
